.class public Lfreemarker/ext/servlet/IncludePage;
.super Ljava/lang/Object;
.source "IncludePage.java"

# interfaces
.implements Lfreemarker/template/TemplateDirectiveModel;


# annotations
.annotation system Ldalvik/annotation/MemberClasses;
    value = {
        Lfreemarker/ext/servlet/IncludePage$CustomParamsRequest;
    }
.end annotation


# instance fields
.field private final request:Ljavax/servlet/http/HttpServletRequest;

.field private final response:Ljavax/servlet/http/HttpServletResponse;


# direct methods
.method public constructor <init>(Ljavax/servlet/http/HttpServletRequest;Ljavax/servlet/http/HttpServletResponse;)V
    .locals 0
    .param p1, "request"    # Ljavax/servlet/http/HttpServletRequest;
    .param p2, "response"    # Ljavax/servlet/http/HttpServletResponse;

    .line 64
    invoke-direct {p0}, Ljava/lang/Object;-><init>()V

    .line 65
    iput-object p1, p0, Lfreemarker/ext/servlet/IncludePage;->request:Ljavax/servlet/http/HttpServletRequest;

    .line 66
    iput-object p2, p0, Lfreemarker/ext/servlet/IncludePage;->response:Ljavax/servlet/http/HttpServletResponse;

    .line 67
    return-void
.end method


# virtual methods
.method public execute(Lfreemarker/core/Environment;Ljava/util/Map;[Lfreemarker/template/TemplateModel;Lfreemarker/template/TemplateDirectiveBody;)V
    .locals 17
    .param p1, "env"    # Lfreemarker/core/Environment;
    .param p2, "params"    # Ljava/util/Map;
    .param p3, "loopVars"    # [Lfreemarker/template/TemplateModel;
    .param p4, "body"    # Lfreemarker/template/TemplateDirectiveBody;
    .annotation system Ldalvik/annotation/Throws;
        value = {
            Lfreemarker/template/TemplateException;,
            Ljava/io/IOException;
        }
    .end annotation

    .line 74
    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    const-string v0, "path"

    invoke-interface {v3, v0}, Ljava/util/Map;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v0

    move-object v4, v0

    check-cast v4, Lfreemarker/template/TemplateModel;

    .line 75
    .local v4, "path":Lfreemarker/template/TemplateModel;
    if-eqz v4, :cond_9

    .line 78
    instance-of v0, v4, Lfreemarker/template/TemplateScalarModel;

    const/4 v5, 0x1

    const/4 v6, 0x0

    const/4 v7, 0x2

    if-eqz v0, :cond_8

    .line 83
    move-object v0, v4

    check-cast v0, Lfreemarker/template/TemplateScalarModel;

    invoke-interface {v0}, Lfreemarker/template/TemplateScalarModel;->getAsString()Ljava/lang/String;

    move-result-object v8

    .line 84
    .local v8, "strPath":Ljava/lang/String;
    if-eqz v8, :cond_7

    .line 92
    invoke-virtual/range {p1 .. p1}, Lfreemarker/core/Environment;->getOut()Ljava/io/Writer;

    move-result-object v9

    .line 94
    .local v9, "envOut":Ljava/io/Writer;
    iget-object v0, v1, Lfreemarker/ext/servlet/IncludePage;->response:Ljavax/servlet/http/HttpServletResponse;

    invoke-interface {v0}, Ljavax/servlet/http/HttpServletResponse;->getWriter()Ljava/io/PrintWriter;

    move-result-object v0

    if-ne v9, v0, :cond_0

    .line 97
    iget-object v0, v1, Lfreemarker/ext/servlet/IncludePage;->response:Ljavax/servlet/http/HttpServletResponse;

    move-object v10, v0

    .local v0, "wrappedResponse":Ljavax/servlet/http/HttpServletResponse;
    goto :goto_1

    .line 100
    .end local v0    # "wrappedResponse":Ljavax/servlet/http/HttpServletResponse;
    :cond_0
    instance-of v0, v9, Ljava/io/PrintWriter;

    if-eqz v0, :cond_1

    move-object v0, v9

    check-cast v0, Ljava/io/PrintWriter;

    goto :goto_0

    :cond_1
    new-instance v0, Ljava/io/PrintWriter;

    invoke-direct {v0, v9}, Ljava/io/PrintWriter;-><init>(Ljava/io/Writer;)V

    .line 106
    .local v0, "printWriter":Ljava/io/PrintWriter;
    :goto_0
    new-instance v10, Lfreemarker/ext/servlet/IncludePage$1;

    iget-object v11, v1, Lfreemarker/ext/servlet/IncludePage;->response:Ljavax/servlet/http/HttpServletResponse;

    invoke-direct {v10, v1, v11, v0}, Lfreemarker/ext/servlet/IncludePage$1;-><init>(Lfreemarker/ext/servlet/IncludePage;Ljavax/servlet/http/HttpServletResponse;Ljava/io/PrintWriter;)V

    .line 115
    .end local v0    # "printWriter":Ljava/io/PrintWriter;
    .local v10, "wrappedResponse":Ljavax/servlet/http/HttpServletResponse;
    :goto_1
    const-string v0, "inherit_params"

    invoke-interface {v3, v0}, Ljava/util/Map;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v0

    move-object v11, v0

    check-cast v11, Lfreemarker/template/TemplateModel;

    .line 116
    .local v11, "inheritParamsModel":Lfreemarker/template/TemplateModel;
    const/4 v0, 0x3

    if-nez v11, :cond_2

    .line 118
    const/4 v12, 0x1

    .local v12, "inheritParams":Z
    goto :goto_2

    .line 121
    .end local v12    # "inheritParams":Z
    :cond_2
    instance-of v12, v11, Lfreemarker/template/TemplateBooleanModel;

    if-eqz v12, :cond_6

    .line 126
    move-object v12, v11

    check-cast v12, Lfreemarker/template/TemplateBooleanModel;

    invoke-interface {v12}, Lfreemarker/template/TemplateBooleanModel;->getAsBoolean()Z

    move-result v12

    .line 130
    .restart local v12    # "inheritParams":Z
    :goto_2
    const-string v13, "params"

    invoke-interface {v3, v13}, Ljava/util/Map;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v13

    check-cast v13, Lfreemarker/template/TemplateModel;

    .line 134
    .local v13, "paramsModel":Lfreemarker/template/TemplateModel;
    if-nez v13, :cond_3

    if-eqz v12, :cond_3

    .line 137
    iget-object v0, v1, Lfreemarker/ext/servlet/IncludePage;->request:Ljavax/servlet/http/HttpServletRequest;

    move-object v5, v0

    .local v0, "wrappedRequest":Ljavax/servlet/http/HttpServletRequest;
    goto :goto_4

    .line 142
    .end local v0    # "wrappedRequest":Ljavax/servlet/http/HttpServletRequest;
    :cond_3
    if-eqz v13, :cond_5

    .line 144
    invoke-static {v13}, Lfreemarker/template/utility/DeepUnwrap;->unwrap(Lfreemarker/template/TemplateModel;)Ljava/lang/Object;

    move-result-object v14

    .line 145
    .local v14, "unwrapped":Ljava/lang/Object;
    instance-of v15, v14, Ljava/util/Map;

    if-eqz v15, :cond_4

    .line 150
    move-object v0, v14

    check-cast v0, Ljava/util/Map;

    .line 151
    .end local v14    # "unwrapped":Ljava/lang/Object;
    .local v0, "paramsMap":Ljava/util/Map;
    goto :goto_3

    .line 146
    .end local v0    # "paramsMap":Ljava/util/Map;
    .restart local v14    # "unwrapped":Ljava/lang/Object;
    :cond_4
    new-instance v15, Lfreemarker/core/_MiscTemplateException;

    new-array v0, v0, [Ljava/lang/Object;

    const-string v16, "Expected \"params\" to unwrap into a java.util.Map. It unwrapped into "

    aput-object v16, v0, v6

    .line 148
    invoke-virtual {v14}, Ljava/lang/Object;->getClass()Ljava/lang/Class;

    move-result-object v6

    invoke-virtual {v6}, Ljava/lang/Class;->getName()Ljava/lang/String;

    move-result-object v6

    aput-object v6, v0, v5

    const-string v5, " instead."

    aput-object v5, v0, v7

    invoke-direct {v15, v2, v0}, Lfreemarker/core/_MiscTemplateException;-><init>(Lfreemarker/core/Environment;[Ljava/lang/Object;)V

    throw v15

    .line 153
    .end local v14    # "unwrapped":Ljava/lang/Object;
    :cond_5
    sget-object v0, Ljava/util/Collections;->EMPTY_MAP:Ljava/util/Map;

    .line 155
    .restart local v0    # "paramsMap":Ljava/util/Map;
    :goto_3
    new-instance v5, Lfreemarker/ext/servlet/IncludePage$CustomParamsRequest;

    iget-object v6, v1, Lfreemarker/ext/servlet/IncludePage;->request:Ljavax/servlet/http/HttpServletRequest;

    const/4 v7, 0x0

    invoke-direct {v5, v6, v0, v12, v7}, Lfreemarker/ext/servlet/IncludePage$CustomParamsRequest;-><init>(Ljavax/servlet/http/HttpServletRequest;Ljava/util/Map;ZLfreemarker/ext/servlet/IncludePage$1;)V

    .line 161
    .end local v0    # "paramsMap":Ljava/util/Map;
    .local v5, "wrappedRequest":Ljavax/servlet/http/HttpServletRequest;
    :goto_4
    :try_start_0
    iget-object v0, v1, Lfreemarker/ext/servlet/IncludePage;->request:Ljavax/servlet/http/HttpServletRequest;

    invoke-interface {v0, v8}, Ljavax/servlet/http/HttpServletRequest;->getRequestDispatcher(Ljava/lang/String;)Ljavax/servlet/RequestDispatcher;

    move-result-object v0

    invoke-interface {v0, v5, v10}, Ljavax/servlet/RequestDispatcher;->include(Ljavax/servlet/ServletRequest;Ljavax/servlet/ServletResponse;)V
    :try_end_0
    .catch Ljavax/servlet/ServletException; {:try_start_0 .. :try_end_0} :catch_0

    .line 166
    nop

    .line 167
    return-void

    .line 164
    :catch_0
    move-exception v0

    .line 165
    .local v0, "e":Ljavax/servlet/ServletException;
    new-instance v6, Lfreemarker/core/_MiscTemplateException;

    invoke-direct {v6, v0, v2}, Lfreemarker/core/_MiscTemplateException;-><init>(Ljava/lang/Throwable;Lfreemarker/core/Environment;)V

    throw v6

    .line 122
    .end local v0    # "e":Ljavax/servlet/ServletException;
    .end local v5    # "wrappedRequest":Ljavax/servlet/http/HttpServletRequest;
    .end local v12    # "inheritParams":Z
    .end local v13    # "paramsModel":Lfreemarker/template/TemplateModel;
    :cond_6
    new-instance v12, Lfreemarker/core/_MiscTemplateException;

    new-array v0, v0, [Ljava/lang/Object;

    const-string v13, "\"inherit_params\" should be a boolean but it\'s a(n) "

    aput-object v13, v0, v6

    .line 124
    invoke-virtual {v11}, Ljava/lang/Object;->getClass()Ljava/lang/Class;

    move-result-object v6

    invoke-virtual {v6}, Ljava/lang/Class;->getName()Ljava/lang/String;

    move-result-object v6

    aput-object v6, v0, v5

    const-string v5, " instead"

    aput-object v5, v0, v7

    invoke-direct {v12, v2, v0}, Lfreemarker/core/_MiscTemplateException;-><init>(Lfreemarker/core/Environment;[Ljava/lang/Object;)V

    throw v12

    .line 85
    .end local v9    # "envOut":Ljava/io/Writer;
    .end local v10    # "wrappedResponse":Ljavax/servlet/http/HttpServletResponse;
    .end local v11    # "inheritParamsModel":Lfreemarker/template/TemplateModel;
    :cond_7
    new-instance v0, Lfreemarker/core/_MiscTemplateException;

    const-string v5, "String value of \"path\" parameter is null"

    invoke-direct {v0, v2, v5}, Lfreemarker/core/_MiscTemplateException;-><init>(Lfreemarker/core/Environment;Ljava/lang/String;)V

    throw v0

    .line 79
    .end local v8    # "strPath":Ljava/lang/String;
    :cond_8
    new-instance v0, Lfreemarker/core/_MiscTemplateException;

    new-array v7, v7, [Ljava/lang/Object;

    const-string v8, "Expected a scalar model. \"path\" is instead "

    aput-object v8, v7, v6

    new-instance v6, Lfreemarker/core/_DelayedFTLTypeDescription;

    invoke-direct {v6, v4}, Lfreemarker/core/_DelayedFTLTypeDescription;-><init>(Lfreemarker/template/TemplateModel;)V

    aput-object v6, v7, v5

    invoke-direct {v0, v2, v7}, Lfreemarker/core/_MiscTemplateException;-><init>(Lfreemarker/core/Environment;[Ljava/lang/Object;)V

    throw v0

    .line 76
    :cond_9
    new-instance v0, Lfreemarker/core/_MiscTemplateException;

    const-string v5, "Missing required parameter \"path\""

    invoke-direct {v0, v2, v5}, Lfreemarker/core/_MiscTemplateException;-><init>(Lfreemarker/core/Environment;Ljava/lang/String;)V

    throw v0
.end method
